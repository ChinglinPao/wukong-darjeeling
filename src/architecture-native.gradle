binaries.all {
    cCompiler.args "-gdwarf-2"
    cCompiler.args "-ggdb"
    cCompiler.args "-Wall"
    cCompiler.args "-Werror"
    cCompiler.args "-std=gnu99"
}

tasks.architectureSpecificAssemble { 
    dependsOn tasks['createLibArchive']
    dependsOn tasks['createAppArchive']

    def libInfusion = tasks['createLibArchive'].archiveFile
    def appInfusion = tasks['createAppArchive'].archiveFile
    def executable = djTargetElfFile
    ext.destDir = new File("${buildDir}/darjeeling")

    inputs.file libInfusion
    inputs.file appInfusion
    inputs.file executable
    outputs.dir destDir

    doLast {
        ensureEmptyDir(destDir)
        copy { from libInfusion into destDir }
        copy { from appInfusion into destDir }
        copy { from executable into destDir }
    }
}
