<project name="compiler">
	<property name="ar" value="ar"/>
	
	<dirname property="compilerpath" file="${ant.file.compiler}"/>
	
	<import file="${compilerpath}/../../taskdefs.xml"/>

	<!-- Compile C code using GCC -->
	<macrodef name="platform-compile">
		<attribute name="objectfiles"/>
		<element name="compiler-args" optional="true"/>
		<element name="compile-elements"/>
		<sequential>
<!-- 
			<exec executable="xml2-config" outputproperty="libxml2-cflags">
				<arg value="- -cflags"/>
			</exec>
 -->
			<mkdir dir="@{objectfiles}"/>
			<cc
				name="gcc"
				objdir="@{objectfiles}"
				>
				<compiler>
					<compilerarg value="-gdwarf-2"/>
					<compilerarg value="-ggdb"/>
					<compilerarg value="-Wall"/>
					<compilerarg value="-Werror"/>
					<compilerarg value="-std=gnu99"/>

					<compilerarg value="-I/opt/local/include/libxml2"/>

					<compiler-args/>
				</compiler>

				<compile-elements/>
			</cc>
		</sequential>
	</macrodef>

	<!-- Link C code using GCC -->
	<macrodef name="platform-link">
		<attribute name="outputfile"/>
		<element name="link-elements"/>
		<sequential>
<!-- 
			<exec executable="xml2-config" outputproperty="libxml2-libs">
				<arg value="- -libs"/>
			</exec>
 -->
			<cc
				name="gcc"
				outfile="@{outputfile}"
				>
				<linker>

					<linkerarg value="-L/opt/local/lib"/>
					<linkerarg value="-lxml2"/>
					<linkerarg value="-lz"/>
					<linkerarg value="-lpthread"/>
					<linkerarg value="-liconv"/>
					<linkerarg value="-lm"/>

				</linker>
				
				<link-elements/>
			</cc>
		</sequential>
	</macrodef>
	
	<!-- Link C code using GCC -->
	<macrodef name="platform-objcopy">
		<attribute name="inputfile"/>
		<attribute name="outputfile"/>
		<attribute name="arrayname"/>
		<!-- Load the inputfile directly for native target instead of compiling it to a c file and linking it in to the VM -->
		<sequential/>
	</macrodef>

</project>
