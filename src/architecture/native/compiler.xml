<project name="compiler">
	<property name="ar" value="ar"/>
	
	<dirname property="compilerpath" file="${ant.file.compiler}"/>
	
	<import file="${compilerpath}/../../taskdefs.xml"/>

	<!-- Compile C code using GCC -->
	<macrodef name="platform-compile">
		<attribute name="objectfiles"/>
		<element name="compiler-args" optional="true"/>
		<element name="compile-elements"/>
		<sequential>
			<mkdir dir="@{objectfiles}"/>
			<cc
				name="gcc"
				objdir="@{objectfiles}"
				>
				<compiler>
					<compilerarg value="-gdwarf-2"/>
					<compilerarg value="-ggdb"/>
					<compilerarg value="-Wall"/>
					<compilerarg value="-Werror"/>
					<compilerarg value="-std=c99"/>
					<compiler-args/>
				</compiler>
				
				<compile-elements/>
			</cc>
		</sequential>
	</macrodef>

	<!-- Link C code using GCC -->
	<macrodef name="platform-link">
		<attribute name="outputfile"/>
		<element name="link-elements"/>
		<sequential>
			<cc
				name="gcc"
				outfile="@{outputfile}"
				>
				<linker/>
				
				<link-elements/>
			</cc>
		</sequential>
	</macrodef>
	
	<!-- Link C code using GCC -->
	<macrodef name="platform-objcopy">
		<attribute name="inputfile"/>
		<attribute name="outputfile"/>
		<attribute name="arrayname"/>
		<sequential>
			<!-- compile the binary file to a .c file -->
			<local name="arraysize"/>
			<condition property="arraysize" value="${app-archive-size}" else="0">
				<equals arg1="@{arrayname}" arg2="di_app_archive"/>
			</condition>
			<carray
				src="@{inputfile}"
				dest="temp_@{arrayname}.c"
				arrayname="@{arrayname}"
				arraysize="${arraysize}"
			/>
			<!-- compile -->
			<cc
				name="gcc"
				objdir="."
				>
				<fileset includes="temp_@{arrayname}.c" dir="."/>
			</cc>
			<exec executable="mv">
				<arg line="temp_@{arrayname}.o @{outputfile}"/>
			</exec>
			<!-- clean up temp file -->
			<!-- <delete file="temp.c"/> -->
		</sequential>
	</macrodef>

</project>
